# 3D Point Cloud Video Processing

This project provides a Python pipeline to process a sequence of 3D point clouds (e.g., from a video). It intelligently downsamples the point cloud over time by identifying new regions and selecting representative points, creating a progressively growing model of the scene.

## Scripts

  - `cluster_3d_points_video.py`: The main processing script. It takes a sequence of point cloud frames as input, identifies new points that appear over time, clusters them to select representative key points, and saves the evolving point cloud sequence to a `.pkl` file.
  - `visualize_representative_pc.py`: A viewer to visualize the output from the clustering script. It plays back the sequence, showing how the representative point cloud builds up frame-by-frame.

## Requirements

You can install the necessary libraries using pip:

```bash
pip install numpy tqdm open3d
```

## Usage

Follow these steps to process and visualize your point cloud sequence.

### 1\. Prepare Your Data

Ensure your input data is a single `.pkl` file containing a **list of Python dictionaries**. Each dictionary represents one frame and must contain:

  * `'xyz'`: A NumPy array of shape `(N, 3)` for point coordinates.
  * `'rgb'`: A NumPy array of shape `(N, 3)` for point colors (values from 0 to 1).

### 2\. Run the Clustering Script

Execute the script from your terminal to process the raw point cloud sequence. This will generate a new `.pkl` file containing the sequence of representative points.

```bash
# Use default settings
python cluster_3d_points_video.py

# Or specify custom parameters
python cluster_3d_points_video.py --input_path your_data.pkl --output_path final_points.pkl --cluster_radius 0.1
```

  * `--input_path`: Path to your raw point cloud data (default: `all_frames_gaussians.pkl`).
  * `--output_path`: Path to save the processed sequence (default: `representative_points_sequence_with_color.pkl`).
  * `--cluster_radius`: Radius used for downsampling points.
  * `--cache_threshold`: Number of new points to accumulate before processing.

### 3\. Visualize the Result

Use the visualization script to view the generated sequence. The window will show the point cloud growing as it animates through the frames.

```bash
# Use the default output file from step 2
python visualize_representative_pc.py

# Or specify the input file and other parameters
python visualize_representative_pc.py --input_path final_points.pkl --fps 20 --point_size 4.0
```

  * `--input_path`: Path to the file generated by the clustering script.
  * `--fps`: Playback frames per second.
  * `--point_size`: Render size for each point.
